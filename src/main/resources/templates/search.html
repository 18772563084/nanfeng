<!doctype html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<meta charset="utf-8">
<title>搜索&nbsp;-&nbsp;南风共享</title>
<style type="text/css">
input::-webkit-input-placeholder {color:#555}
input {-webkit-appearance:none;margin:0;padding:0}
	a{display: block;text-decoration:none;}
* {tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;outline:none;font-family:Arial,Helvetica,sans-serif;}
body {position:absolute;background-color:#fff;width:100vw!important;height:100%;margin:0;}
#top{position: fixed;top: 0; background-color: #fff;width: 100vw;height: 20vw;z-index: 99;}
#search {position:fixed;margin:4vw;width:92vw;height:10vw;top:0;left:0;border-radius:5vw;background-color:rgba(200,200,200,0.7);z-index: 200}
#search svg {position:absolute;width:5vw;height:5vw;top:2.5vw;left:4vw;fill:#222}
#search input {position:absolute;width:73vw;height:8vw;top:1vw;left:12vw;background-color:transparent;border:0;font-size:4.5vw;line-height:8vw;color:#222}
#choose {position:absolute;width:100vw;top:13vw;left:0;height:11vw;z-index:100;text-align:center;line-height:8vw;font-size:4vw;border-bottom:0.2vw solid #ccc;background-color: #fff}
#choose span {position:absolute;width:20vw;height:8vw;border-bottom:1vw solid rgb(170,0,0);bottom:0;z-index:101;color: rgb(170,0,0)}
#choose .un {color: inherit!important;border: none!important;bottom: 1vw!important}
#goods {position:absolute;top:23vw;}
.card {display:block;position:relative;width:94vw;margin:3vw;background-color:#fff;overflow:hidden;text-decoration:none;color:#222;border-bottom:0.2vw dotted #aaa;}
.card div {position:relative;height:30vw;margin:2vw;text-align:center;top:12vw;white-space:nowrap;}
.card p {position:relative;width:78vw;top:8vw;left:4vw;color:#888;overflow:hidden;font-size:4vw;}
.card img {height:28vw;margin:0;margin-right:1vw;margin-left:1vw;display:block;float:left;box-shadow:0 0 1vw 0 #555;opacity:0;-webkit-transition:.5s;transition:.5s;}
h1,h2,h3,h4,h5,h6 {-webkit-margin-before:0!important;-webkit-margin-after:0!important;-webkit-margin-start:0!important;-webkit-margin-end:0!important;}
.card h1 {position:absolute;left:4vw;top:4vw;font-size:5vw;font-weight:600;color:#333;}
.card h2 {position:absolute;right:4vw;top:4vw;font-size:5vw;font-weight:500;color:rgb(170,0,0);font-family: Impact, Charcoal, sans-serif;}
.card h3 {position:absolute;left:17vw;top: 1vw; font-size:4.5vw;font-weight:500;}
.card h4 {position:absolute;left:17vw;bottom: 1vw; font-size:3.5vw;font-weight:300;}
.card h5 {position:absolute;right:4vw;top: 0;font-size:4.5vw;font-weight:500;color:rgb(170,0,0)}
.card h6 {position:absolute;right:4vw;bottom: 0;font-size:4.1vw;font-weight:300;height:6vw;line-height:6vw;vertical-align:middle;color:#bbb;}
/*.card h6 svg {width:6vw;height:6vw;fill:#555;vertical-align:middle;margin-right:1vw;}*/
.card h {position:absolute;display: block;left:3vw;top: 1vw; height:11vw;width:11vw;border-radius:6vw;background-size:100% 100%;background-repeat:no-repeat;box-shadow:0 0 1vw 0 #555}
.card span{position:relative;display: block; width: 94vw;height: 13vw;margin: 10vw 0 5vw 0}
#loading {position:absolute;background-color:transparent;border-bottom: none!important; font-size:5vw;line-height:20vw;text-align:center;bottom:-50vw;height: 50vw}
</style>
</head>
<body>
<div id="top">
	<div id="search">
		<input type="text" id="search_inp" placeholder="想找点儿什么">
		<svg viewBox="0 0 1024 1024"><path d="M1001.526404 991.699618C999.922771 986.822379 999.922771 986.822379 998.661741 984.531443 997.556333 982.547938 996.293839 980.724943 994.702325 978.653549 992.500075 975.787264 989.423708 972.169135 985.358477 967.619563 978.223881 959.634933 967.82403 948.546074 954.04227 934.18551 932.495573 911.733901 910.909628 889.684252 858.479859 836.391998 806.561909 783.619985 784.782022 761.370402 763.425645 739.113463 750.035742 725.158933 739.986204 714.441517 733.331893 706.993367 730.0273 703.294545 727.65239 700.501581 726.365602 698.828322 727.222236 700.438869 727.222236 700.438869 728.57702 704.41879 730.685899 711.913483 730.685899 711.913483 721.610157 729.174018 803.853596 649.91606 851.33145 539.987051 851.33145 422.399774 851.33145 189.11482 665.530044 0 436.332393 0 207.134741 0 21.333333 189.11482 21.333333 422.399774 21.333333 655.684727 207.134741 844.799548 436.332393 844.799548 441.356706 844.799548 446.556279 844.56416 452.347883 844.11767 456.487002 843.798575 460.079727 843.454155 466.651669 842.776804 479.958906 841.405269 484.804847 841.014569 490.397372 841.014558 499.896397 841.014541 514.964663 837.646929 537.39015 831.429666 540.021178 830.700239 542.719546 829.938705 545.476431 829.148403 553.976567 826.711712 562.667765 824.108471 571.097184 821.505798 576.160226 819.942528 580.026436 818.721914 582.233225 818.013231 595.480279 813.759108 602.830912 799.380094 598.651326 785.896804 594.471738 772.413515 580.344653 764.931795 567.097598 769.18592 565.058735 769.840674 561.367413 771.006074 556.494825 772.510539 548.364858 775.020755 539.986116 777.530404 531.839533 779.865745 529.217662 780.617342 526.657771 781.339795 524.170112 782.029476 506.936476 786.807345 493.480702 789.814579 490.397278 789.814586 482.458716 789.814601 476.720548 790.277235 461.583853 791.837329 455.416051 792.473024 452.140828 792.787008 448.548723 793.063932 443.933724 793.419714 439.960704 793.599575 436.332393 793.599575 234.916275 793.599575 71.63625 627.407763 71.63625 422.399774 71.63625 217.391785 234.916275 51.199973 436.332393 51.199973 637.74851 51.199973 801.028533 217.391785 801.028533 422.399774 801.028533 525.775443 759.336083 622.309077 687.025254 691.994987 677.769918 709.563029 677.769918 709.563029 679.976768 717.62707 681.566101 722.305182 681.566101 722.305182 682.808947 724.550298 683.910231 726.511657 685.170219 728.326692 686.754421 730.386692 688.964348 733.260343 692.047349 736.886044 696.115554 741.439575 703.261474 749.437982 713.66454 760.532418 727.438434 774.887134 749.001325 797.359294 770.84669 819.675765 822.916311 872.601946 875.194278 925.7399 896.716879 947.724843 918.057933 969.962174 931.455439 983.922347 941.502012 994.634524 948.144469 1002.068378 951.440527 1005.757135 953.805218 1008.538259 955.077419 1010.194061 954.139053 1008.441707 954.139053 1008.441707 952.75811 1004.249822 950.686453 996.172693 950.686453 996.172693 960.850534 978.849743 950.24269 987.977788 948.913429 1004.130236 957.881542 1014.927251 966.849655 1025.724265 982.719104 1027.077231 993.326948 1017.949188 1003.683753 1000.332838 1003.683753 1000.332838 1001.526404 991.699618Z" /></svg>
	</div>
	<div id="choose">
		<span style="left: 25vw" onClick="choose(1)">闲置</span>
		<span style="right:25vw" onClick="choose(0)">需求</span>
	</div>
</div>

<div id="goods_type" class="card"></div>
<div id="goods"></div>
<div style="position: absolute;top: 35vw;height: 100vh;width: 1vw;"></div>
</body>
<script type="text/javascript" src="/js/pengge_tools.js"></script>
<script type="text/javascript">
"use strict";
var doc = document,
page_num = 0,
isWantBy = 1,
vw = doc.body.clientWidth,
choose_dom = doc.getElementById("choose").getElementsByTagName("span"),
hchoose = doc.getElementById("choose").style,
hgoods = doc.getElementById("goods"),
goods_finish=false,
timer = null,
wd="";
function choose(a) {
    if (choose_dom[a].className !== "") {
        return;
    }
   window.scrollTo(0,0);
    choose_dom[isWantBy].className = "";
    isWantBy = a;
    choose_dom[isWantBy].className = "un";
	lo();
}
doc.getElementById("search").getElementsByTagName("svg")[0].onclick=function(){
	wd=doc.getElementById("search_inp").value;
	lo();
}
window.onload = function() {


wd=pengge.url.data("wd")||"";
	doc.getElementById("search_inp").value=wd;
	
	isWantBy=pengge.url.data("isWantBy")||isWantBy;
    choose(isWantBy);	

	

}
function lo(){
	hgoods.innerHTML = '<div class="card goods" id="loading">'+((wd==="")?"请输入关键词搜索":"正在加载……")+'</div>';
if(wd===""){return;}
	    window.history.pushState({} , 0 , location.pathname + "?isWantBy=" + isWantBy + "&wd=" + encodeURI(wd)+ "&");
	doc.title="搜索 "+pengge.nanfenggx.font_len(wd,20)+" - 南风共享";
	get_goods();
}
function get_goods() {
    pengge.post("/public/commodity/search", "isWantBy=" + isWantBy + "&goodsName=" + pengge.html_encode(wd) + "&page=" + page_num * 10 + "&isSellOut=0&goodsType=0",
    function(data) {
		
        var out = "",
        data_arr = JSON.parse(data),
        pic_len = 0,
		content_len;

        for (var j = 0; j < data_arr.length; j++) {
			content_len=300;
            out += '<a name="card" class="card" target="view_window" href="goods?gid=' + data_arr[j]["gid"] + '"><h1>' + pengge.nanfenggx.font_len(data_arr[j]["goods_name"], 18) + '</h1><h2>￥' + data_arr[j]["price"] / 100 + '</h2>';
			if(data_arr[j]["picture"]!==undefined&&data_arr[j]["picture"].toString().length>5){
			
			content_len=36;
			out+="<div>";
			data_arr[j]["picture"] = JSON.parse(data_arr[j]["picture"]);
            pic_len = (data_arr[j]["picture"].length >= 3) ? 3 : data_arr[j]["picture"].length;
            for (var i = 0; i < pic_len; i++) {
                out += '<img onload="img_onload(this)" src="http://pic.zdnfbbs.cn/' + data_arr[j]["picture"][i] + '"alt=""/>';
            }
            out += '</div>';
			}
            out +=  '<p>' + pengge.nanfenggx.font_len(data_arr[j]["content"].replace(/<br>/g, " "),content_len) + '</p><span><h style="background-image:url(http://pic.zdnfbbs.cn/' + data_arr[j]["head_pic"] + ')"></h><h3>' + pengge.nanfenggx.font_len(data_arr[j]["nick_name"],16) + '</h3><h4>' + (data_arr[j]["school"] || "中山大学南方学院") + '</h4><h5>' + ((data_arr[j]["is_sell_out"] === 0) ? ((isWantBy===1)?"正在销售":"正渴望着"): "已下架") + '</h5><h6>' + pengge.get_time(data_arr[j]["release_time"] / 1000)  + '</h6></span></a>';
        }
        hgoods.innerHTML += out;
        if (j < 10) {
            goods_finish = true;
            doc.getElementById("loading").innerHTML = "没有更多搜索结果了";

        } else {
            page_num++;

        }

    });
}
function img_onload(a) {
    if (a.offsetTop < vw * 0.2) {
        a.style.opacity = "1";
    } else {
        a.style.display = "none"
    }

}
doc.onscroll = function() {
    var top = doc.documentElement.scrollTop || doc.body.scrollTop;


        var check = function() {
            if (((doc.body.scrollHeight) - top - doc.body.clientHeight) <= vw) {
                get_goods();
            }
        }

        if (goods_finish) {
            return;
        }
        if (timer === null) {
            check();
            timer = setTimeout(function() {
                check();
                timer = null;
            },
            1000);
        }

    }
</script>
</html>
