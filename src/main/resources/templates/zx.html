<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://unpkg.com/vue"></script>
<script src="https://cdn.bootcss.com/velocity/2.0.2/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.3.4"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.13.1/lodash.min.js"></script>
       

<style>
    .ui-upload {
      height: 80px;
      width: 80px;
      
      font-size: 14px;
      line-height: 30px;
      cursor: pointer;
      display: inline-block;
      text-align: center;
      color: #fff;
      border-radius: 3px;
      border: 0px;
      background-image: url( static/images/porf.gif);
      background-size: 100% 100%;
      float: left;
    }
  </style>

        <style>
            *{
                margin: 0;
                padding: 0;
            }
            body{
                background-color: #eeeeee;
            }
            ul{
                list-style-type:none;
            }
        </style>
        
        <link href="static/css/9002.css" rel="stylesheet">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    
    <body style="max-width: 410px;">
        <div id = 'data'>
        <table style='width: 100%;position: fixed;height:45px;background-color: #ffffff;top:0%;border-bottom: 1px #cccccc solid;max-width: 410px;'>
            <td style='width:20%;text-align: center'>
            <div style='height: 45px;position: relative;top:14px;'>
            <img src='static/images/向左.png' style='height:18px;width:18px;float:left' onclick="a.ve.ifshow = false;setTimeout( ()=> { window.scrollTo(0,nowS);bool = true;  });  ">
            
            </div>
        </td>
            
        <td style='width:15%;text-align: center'>
            <div style='height: 45px;position: relative;top:4px;' class="ass" onclick="a.ve.lis = [];nowtype = 1; page = 0;a.ve.ifshow = false;">
            <img src='static/images/兼职.png' style='height:18px;width:18px;'>
            <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >兼职</p></div>
            </div>
        </td>
        <td style='width:15%;text-align: center'>
            <div style='height: 45px;position: relative;top:4px;' class="ass" onclick="a.ve.lis = [];nowtype = 2; page = 0;a.ve.ifshow = false;">
            <img src='static/images/call.png' style='height:18px;width:18px;'>
            <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >打听</p></div>
            </div>
        </td>
        <td style='width:15%;text-align: center'>
            <div style='height: 45px;position: relative;top:4px;' class="ass" onclick="a.ve.lis = [];nowtype = 3; page = 0;a.ve.ifshow = false;">
            <img src='static/images/find.png' style='height:18px;width:18px;'>
            <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >寻物</p></div>
            </div>
        </td>
        <td style='width:15%;text-align: center'>
            <div style='height: 45px;position: relative;top:4px;'class="ass" onclick="a.ve.lis = [];nowtype = 4; page = 0;a.ve.ifshow = false;">
            <img src='static/images/福利.png' style='height:18px;width:18px;'>
            <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >福利</p></div>
            </div>
        </td>
        <td style='width:20%;text-align: center'>
            <div style='height: 45px;position: relative;top:14px;width: 100%'>
            <img src='static/images/Category.png' style='height:18px;width:18px;float: right;margin-right: 5px;' v-on:click="dragshow = !dragshow">
            
            <div id="dragdown" style="width:100%;background-color: #ffffff" v-show="dragshow"  >
                <div style='height: 45px;position: relative;top:4px;' >
            <p style='font-size:12px;position: relative;top:-4px;'></p>
            </div>
                <div style='height: 30px;position: relative;top:4px;' class="ass" onclick="a.ve.lis = [];nowtype = 5; page = 0;a.ve.ifshow = false;">
             <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >求伴</p></div>
            </div>
                <div style='height: 30px;position: relative;top:4px;'class="ass" onclick="a.ve.lis = [];nowtype = 6; page = 0;a.ve.ifshow = false;">
             <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >校园</p></div>
            </div>
                <div style='height: 30px;position: relative;top:4px;'class="ass" onclick="a.ve.lis = [];nowtype = 7; page = 0;a.ve.ifshow = false;">
             <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >服务</p></div>
            </div>
                <div style='height: 30px;position: relative;top:4px;' class="ass" onclick="a.ve.lis = [];nowtype = 8; page = 0;a.ve.ifshow = false;">
             <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >微商</p></div>
            </div>
                <div style='height: 30px;position: relative;top:4px;' class="ass" onclick="a.ve.lis = [];nowtype = 0; page = 0;a.ve.ifshow = false;">
                    <div class="myfont blue" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >全部</p></div>
        
            </div>
                
                
                
            </div>
            
            </div>
            
            
        </td>
        
        
        
        
        
    </table>
        
        
        <ul style="margin-top: 55px;"  v-show='!ifshow'>
            
            
            <transition-group name="fade" tag="p" v-on:duration="300">
                <li style="width: 100%;height: 200px;background-color: #ffffff;margin-top: 10px;"  v-for = '(li,index) in lis' v-bind:key="index"  v-bind:nowcontent ="li"   v-on:click="another(li,{page:0,newsId:li.nid},'public/newsReply/get-by-page')" >
                <ul style="width: 100%;height: 200px;">
                    <li style="width:100%;height: 30px;text-align: center;overflow: hidden">{{li[showDataW[2]]}}</li>
   <li style="width:100%;height: 140px;overflow: hidden;font-size: 14px;text-align: center;overflow: hidden">{{li[showDataW[3]]}}</li>
   <li style="width:100%;height: 30px;"><img style="width: 16px;height: 16px;float: right;margin-right: 10px;" src="static/images/询问.png" alt="xw" /><span style="font-size:12px;float: right;margin-right: 5px;color:#bababa">留言数量等待设置</span></li>
  </ul>
                
            </li>
            </transition-group>

            <li style="width: 100%;height: 30px;margin-top: 10px;"></li>
           <!-- <li class='tli'  style="width: 410px;background-color: #ffffff;position: fixed;bottom:0%;hieght:60px;overflow: hidden;min-height:35px;" onclick = ' '>
                
                
                <input class='mypost'  onclick='$(this).parent().animate({top:"0%"});$(this).hide() ;$(this).parent().find(".postcontent").show();$(".postpng").hide()  '  class='postinput' style='width: 380px;border: #ffffff  solid 1px;float: left;height: 20px' placeholder='你有什么想法？说出来吧' /><img class='postpng' style='float: right;width: 28px;height: 22px' src='询问.png' alt='提交' />
      
                <div class='postcontent' style='display:none;text-align: center;font-family: Microsoft JhengHei;font-size: 14px;font-weight: 700; '> <img onclick='  $(".tli").css("top","");$(".mypost").show() ;$(".postcontent").hide();$(".postpng").show()    '  src='关闭3.png' alt='关闭' style='float:left;width: 22px;height: 22px' /> 编辑帖子 <img  style='float: right;width: 22px;height: 22px' src='myicon/发布.png' alt='提交' /><br/>
                    <br/><input placeholder="写上你的标题吧" v-model="qo" style="width: 380px;border: #ffffff  solid 1px;float: left;height: 30px" ><br/>
                    <input  placeholder="这是帖子的内容哦" v-model="qt"  style="width: 380px;border: #ffffff  solid 1px;float: left;height: 120px"><br/><br/>
                    <button class="ui-upload" onclick="document.getElementById('upload').click()"><img src="myicon/上传.png" style=";width: 28px;height: 28px"/></button>
  <input type="file" id="upload" style="display:none;" />

                </div>  
                </li> -->
    </ul>
        
         <ul style="margin-top: 55px;"  v-show='ifshow'>
             
             <li style="width: 100%;background-color: #ffffff;margin-top: 10px;">
                <ul style="width: 100%;">
                     <li style="width:100%;overflow: hidden;font-size: 14px;text-align: center">{{nowc.title}}</li>
                     <li style="width:100%;height: 20px"><span style="font-size:12px;float: left;margin-right: 5px;color:#bababa">{{nowc.releaseTime}}</span></li>
  
   <li style="width:100%;"><p style="width: 100%;font-size:14px;word-wrap:break-word;text-indent:2em; word-break:break-all; ">{{nowc.content}}</p></li>
     

  </ul>
                
            </li>
             
             
            <transition-group name="fade" tag="p" v-on:duration="300">
            <li style="width: 100%;background-color: #ffffff;margin-top: 10px;"  v-for = '(li,index) in conts' v-bind:key="index">
                <ul style="width: 100%;">
                    <li style="width:100%;height: 60px;"><img style="border-radius: 25px;border: none;height: 50px;width: 50px;float: left;margin-top: 5px;" src="static/images/porf.gif" alt="头"><div style="width:120px;height:50px;display: inline-block;"><p style="margin-top:14px;margin-left: 10px;font-size:12px">{{li.uid}}</p><p style="margin-top:7px;font-size:12px;margin-left: 10px;color:#bababa">{{ index+2+'楼'}}</p></div></li>
   
  <li style="width:100%;min-height: 50px;"><p style="font-size:14px;margin-right: 5px;text-indent:2em;">{{li.content}}</p></li>
  <li style="width:100%;height: 20px"><span style="font-size:12px;float: right;margin-right: 5px;color:#bababa">{{li.releaseTime}}</span></li>
  </ul>
                
            </li>
            </transition-group>
            
            <li style="width: 100%;height: 30px;margin-top: 10px;min-height:35px;"></li>
            <li v-if='ifshow' style="width: 410px;background-color: #ffffff;position: fixed;bottom:0%;hieght:60px;overflow: hidden">
                <input v-model="replycont" style='width: 380px;border: #ffffff  solid 1px;float: left;height: 20px' placeholder='你有什么想法？说出来吧' /><img v-on:click="Reply('private/newsReply/add')" style='float: right;width: 28px;height: 22px' src='static/images/询问.png' alt='提交' />
            </li>
            
            
            

    </ul>
        
            
            <transition name='t' mode="out-in" >
            <div    style="position: fixed;top:40%;width:100%;max-width: 410px;" v-if="warning">
                <div class="warning" style="margin:0 auto;background-color:rgba(255,102,51,0.8);text-align: center;width:100px;color:#fff;border:  #cccccc 1px none;border-radius: 10px;" >asd</div>
            </div>
            </transition> 
            
        </div>
        <script>
     let nowS = '',bool = true,nowtype =0,page;    
     
$(document).ready(function(){
    page = 0;
    
    a.getTop('public/news/get-by-page',{page,type:nowtype});
    $('.ass').on('click',() =>{
         a.getTop('public/news/get-by-page',{page,type:nowtype});
    });
    
    
            $(window).scroll(_.debounce(function(){
                a.ve.ifshow = false;
let scrollTop = parseInt($(this).scrollTop());

let scrollHeight = $(document).height();
let windowHeight = $(this).height();
if(bool){
    nowS = parseInt($(this).scrollTop());
console.log(nowS);
}


if(scrollTop + windowHeight == scrollHeight || scrollTop + windowHeight == scrollHeight-2 ||scrollTop + windowHeight == scrollHeight+1){
console.log("已经到最底部了！");
//这里写实例的新增楼层的方法 和留言

page++;
a.addLIS('public/news/get-by-page',{page,type:nowtype});



}

},300)
        );
});


class F {
    
    
    constructor(redata = [],ansy){
        this.ve = new Vue({
            el:'#data',
            data:{
                lis:[],
                conts:[],
                nowc:{},
                postdata:'',
                postdatasave:'??',
                ifshow:false,
                qo:'',
                qt:'',
                replyId:'',
                tempId:'',//点击了的帖子的id
                replycont:'',
                showDataW:redata,  //一共5个位置
                ansytype:ansy,
                myid:1,
                dragshow:false,//全部框
                warning:false
                
            },
            methods:{
                post(url,p = {},func= undefined ){
                    //差板块id  和
                    
             p = this.postdatasave;
             p.uid = this.myid;
             p.title = this.qo;
             p.content = this.qt;
             p[this.ansytype] =nowtype;
            
         Vue.http.get(allurl+url,{params:p}).then(  (response) => {
          if(response.bodyText === 'success')  { console.log('发布成功');$(".tli").css("top","");$(".mypost").show() ;$(".postcontent").hide();$(".postpng").show() ; 
              p.replyNum = '0';
              p.releaseTime = '刚刚';
          this.lis.push(p);//['uid','releaseTime','title','content','replyNum']
                        }
          if(func){  func(); };
         }); 
    },
    Reply(url,p = {},func = undefined ){
                    //需要  postId uid content
            p.uid = this.myid;        
            p.newsId = this.tempId;
             p.content = this.replycont;
             console.log(p);//这是发布的也包括留言  一切发送的东西
         Vue.http.get(allurl+url,{params:p}).then(  (response) => {
          if(response.bodyText === 'success')  { console.log('发布成功');$(".tli").css("top","");$(".mypost").show() ;$(".postcontent").hide();$(".postpng").show() ; 
          this.conts.push(p);
                        }
          if(func){  func(); };
         }); 
    },
    another(li,p={}/*回复的实体*/,url = undefined){
        this.conts = [];
       this.nowc = li;
        this.tempId = li.nid;
        console.log('??');
        a.changeNOWC(url,p);
    }
            }
        });
    }
    
    
   
    
    getTop(url,p={}){
        /* if(p.type == null){
            delete p.type;
        }  
        
         if(p.plate == null){
            delete p.plate;
        } */
        for(let c in p){
            if(p.c == null){
                delete p.c;
            }
        }
                                                     
             Vue.http.get(allurl+url,{params:p}).then(  (response) => {
            let f =  eval("("+response.bodyText+")");
            f.forEach( (data) => {  a.ve.lis.push(data);  }  );
            
           /* p.isTop = 0;
        this.addLIS(url,p);*/
        });
            
    }
    
    addLIS(url,p={}){          

         Vue.http.get(allurl+url,{params:p}).then(  (response) => {
            let fs =  eval("("+response.bodyText+")");
            fs.forEach( (data) => {  a.ve.lis.push(data);  }  );
         });
    }
    
    addCONTS(url,p){  
        
        Vue.http.get(allurl+url,{params:p}).then(  (response) => {
            var f =  eval("("+response.bodyText+")");
            f.forEach( (data) => {  this.ve.conts.push(data);  }  );
         
         });
        
    }
    
    changeNOWC(url,p={}){

        
        setTimeout(()=>{
            bool = false;
        this.ve.ifshow = true;
          //  p = {page:0,postId:this.ve.nowc.pid};
        this.addCONTS(url,p);
        },200);
        
    }
    
}

let a = new F(['AO','releaseTime','title','content','nothing'],'newsId');


a.ve.postdatasave = {nid:null,title:null,content:null,newsId:null};


//  写一个实体吧  
//{ uid title content replyNum isTop plateId }  {  postId uid content  isDelete  }

 $('.myfont').click( function(){
              $('.myfont').removeClass('blue');
               $(this).addClass('blue');
            });

            
            
var allurl = '';
        </script>
        
    </body>
</html>
