<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://unpkg.com/vue"></script>
<script src="https://cdn.bootcss.com/velocity/2.0.2/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.3.4"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.13.1/lodash.min.js"></script>
       

<style>
    .ui-upload {
      height: 80px;
      width: 80px;
      
      font-size: 14px;
      line-height: 30px;
      cursor: pointer;
      display: inline-block;
      text-align: center;
      color: #fff;
      border-radius: 3px;
      border: 0px;
      background-image: url( static/images/porf.gif);
      background-size: 100% 100%;
      float: left;
    }
  </style>

        <style>
            *{
                margin: 0;
                padding: 0;
            }
            body{
                background-color: #eeeeee;
            }
            ul{
                list-style-type:none;
            }
        </style>
        
        <link href="static/css/9002.css" rel="stylesheet">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    
    <body style="max-width: 410px;">
        <div id = 'data'>
        <table style='width: 100%;position: fixed;height:45px;background-color: #ffffff;top:0%;border-bottom: 1px #cccccc solid;max-width: 410px;'>
            <td style='width:15%;text-align: center'>
            <div style='height: 45px;position: relative;top:14px;'>
            <img src='static/images/向左.png' style='height:18px;width:18px;float:left' onclick="a.ve.ifshow = false;setTimeout( ()=> { window.scrollTo(0,nowS);bool = true;  });  ">
            
            </div>
        </td>
            
        <td style='width:15%;text-align: center'>
            <div style='height: 45px;position: relative;top:4px;' class="ass" onclick="a.ve.lis = [];nowtype = 1; page = 0;a.ve.ifshow = false;">
            <img src='static/images/广场.png' style='height:18px;width:18px;'>
            <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >广场</p></div>
            </div>
        </td>
        <td style='width:15%;text-align: center'>
            <div style='height: 45px;position: relative;top:4px;' class="ass" onclick="a.ve.lis = [];nowtype = 2; page = 0;a.ve.ifshow = false;">
            <img src='static/images/养啦主页.png' style='height:18px;width:18px;'>
            <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >圈子</p></div>
            </div>
        </td>
        <td style='width:15%;text-align: center'>
            <div style='height: 45px;position: relative;top:4px;' class="ass" onclick="a.ve.lis = [];nowtype = 3; page = 0;a.ve.ifshow = false;">
            <img src='static/images/社团.png' style='height:18px;width:18px;'>
            <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >社团</p></div>
            </div>
        </td>
        <td style='width:15%;text-align: center'>
            <div style='height: 45px;position: relative;top:4px;'class="ass" onclick="a.ve.lis = [];nowtype = 4; page = 0;a.ve.ifshow = false;">
            <img src='static/images/养啦主页.png' style='height:18px;width:18px;'>
            <div class="myfont" style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >圈子</p></div>
            </div>
        </td>
        
        
        <td style='width:15%;text-align: center'>
            <div style='height: 45px;position: relative;top:4px;'class="ass" onclick="a.ve.lis = [];nowtype = 0; page = 0;a.ve.ifshow = false;">
            <img src='static/images/Category.png' style='height:18px;width:18px;'>
            <div class="myfont blue"  style='font-size:12px;position: relative;top:-4px;margin: 0 auto;text-align: center;'><p  >全部</p></div>
            </div>
        </td>
        
        
        
        
        
        
    </table>
        
        
        <ul style="margin-top: 55px;"  v-show='!ifshow'>
            <div v-if="lis[0] === undefined" style="width:100%;margin: 0 auto;font-size: 10px;text-align: center">偷偷告诉你这里什么都没有..</div>
               
            <transition-group style="margin-bottom:15vw" name="fade" tag="p" v-on:duration="300">
                
                <li style="width: 100%;height: 135px;background-color: #ffffff;margin-top: 5px;text-overflow: ellipsis"  v-for = '(li,index) in lis' v-bind:key="index"  v-bind:nowcontent ="li"   v-on:click="another(li,{page:0,postId:li.pid},'public/postReply/get-by-page')" >
                <ul style="width: 100%;height: 135px;">
                    <li style="width:100%;height: 45px;"><img style="border-radius: 20px;border: none;height: 40px;width: 40px;float: left;margin-top: 5px;" v-bind:src="li.head_pic" alt="头"><div style="width:220px;height:40px;display: inline-block;"><p style="margin-top:4px;margin-left: 10px;font-size:12px">{{li[showDataW[0]]}}</p><p style="margin-top:7px;font-size:10px;margin-left: 10px;color:#bababa;">{{myDate(li[showDataW[1]])}}</p></div></li>
                    <li style="width:100%;height: 70px;overflow: hidden;font-size: 13px;text-indent:0.5em;font-weight: 600"><p style="white-space: nowrap;text-overflow: ellipsis;width:400px;overflow: hidden">{{li[showDataW[2]]}}</p><p style="font-weight: 400;font-size:12px;margin-right: 5px;margin-top: 4px;text-indent:2.5em;color:#999999">{{li[showDataW[3]]}}</p></li>
   <li style="width:100%;height: 20px;"><img style="width: 16px;height: 16px;float: right;margin-right: 10px;" src="static/images/询问.png" alt="xw" /><span style="font-size:12px;float: right;margin-right: 5px;color:#bababa">{{li[showDataW[4]]}}</span></li>
  </ul>
                
            </li>
            </transition-group>

            <li style="width: 100%;height: 30px;margin-top: 10px;"></li>
            <li v-if='!ifshow' class='tli colorchange'  style="width: 100%;position: fixed;bottom:15vw;hieght:60px;overflow: hidden;min-height:35px;" onclick = ' '>
                <div class=' mypost'  onclick="$(this).parent().animate({top:'0%'});$(this).hide() ;$(this).parent().find('.postcontent').show();$('.postpng').hide();$('.postspan').hide();$('.colorchange').css('background-color','#ffffff')  "  style='width: 100%;float: left;height: 50px;'>
                    <div style="width: 70px;height:38px;font-size: 12px;color:#ffffff;border: #ffffff 1px none;border-radius: 10px;float:right;background-color: rgba(255,102,51,0.8);text-align: center;line-height: 38px;margin-right: 10px"  class="postspan" >发帖</div>
                </div>
                
                   
      
                <div  class='postcontent' style='background-color: #ffffff;display:none;text-align: center;font-family: Microsoft JhengHei;font-size: 14px;font-weight: 700; '> <img onclick="    $('.tli').css('top','');$('.mypost').show() ;$('.postcontent').hide();$('.postpng').show(); $('.postspan').show();$('.colorchange').css('background-color','')   "  src='static/images/关闭3.png' alt='关闭' style='float:left;width: 22px;height: 22px' /> 编辑帖子 <img v-on:click="post('private/post/add')" style='float: right;width: 22px;height: 22px' src='static/images/发帖_icon.png' alt='提交' /><br/>
                    <br/><input placeholder="写上你的标题吧" v-model="qo" style="width: 380px;border: #ffffff  solid 1px;float: left;height: 30px" ><br/><br/>
                    
                    <textarea placeholder="这是帖子的内容哦" v-model="qt"  style="width: 380px;border: #ffffff  solid 1px;float: left;height: 120px" cols="5"></textarea>
                    <br/><br/>
                    <button class="ui-upload" onclick="document.getElementById('upload').click()">该功能尚未开放<img src="static/images/上传.png" style=";width: 28px;height: 28px"/></button>
  <input type="file" id="upload" style="display:none;" />

                </div>  
                </li>
    </ul>
        
         <ul style="margin-top: 55px;"  v-show='ifshow'>
             
             <li style="width: 100%;background-color: #ffffff;margin-top: 10px;margin-bottom: 10px;">
                <ul style="width: 100%;">
                    <li style="margin-bottom: 10px;text-indent:1em;width:100%;overflow: hidden;font-size: 13px;text-align: center;white-space: nowrap;text-overflow: ellipsis;width:400px;overflow: hidden"><p style="font-size:14px;font-weight: 600;white-space: nowrap;text-overflow: ellipsis;width:400px;overflow: hidden">{{nowc.title}}</p></li>
                    <li style="width:100%;height: 60px"><img style="border-radius: 25px;border: none;height: 50px;width: 50px;float: left;margin-top: 5px;" v-bind:src="nowc.head_pic" alt="头"><div style="width:120px;height:50px;display: inline-block;"><p style="margin-top:14px;margin-left: 10px;font-size:12px">{{nowc.nick_name}}</p><p style="margin-top:7px;font-size:12px;margin-left: 10px;color:#bababa">楼主</p></div></li>
   
   <li style="width:100%;"><p style="font-size:12px;margin-right: 5px;text-indent:2em;min-height: 80px;margin-top: 10px">{{nowc.content}}</p></li>
      <li style="width:100%;height: 20px"><span style="font-size:12px;float: right;margin-right: 5px;color:#bababa">{{myDate(nowc.release_time)}}</span></li>

  </ul>
                
            </li>
             
             <div style="width:410px;text-align: center;height: 100%;"><p style="font-size: 12px;"> 全部回复:</p>
                 <div v-if="conts[0] === undefined" style="width:100%;margin: 0 auto;font-size: 10px;text-align: center">偷偷告诉你这里什么都没有..</div>
                 
            <transition-group name="fade" tag="p" v-on:duration="300">
            <li style="width: 100%;background-color: #ffffff;margin-top: 10px;"  v-for = '(li,index) in conts' v-bind:key="index">
                <ul style="width: 100%;">
                    <li style="width:100%;height: 60px;"><img style="border-radius: 25px;border: none;height: 50px;width: 50px;float: left;margin-top: 5px;" v-bind:src="li.head_pic" alt="头"><div style="float:left;width:120px;height:50px;display: inline-block;text-align:  left;"><p style="margin-top:14px;margin-left: 10px;font-size:12px;">{{li.nick_name}}</p><p style="margin-top:7px;font-size:12px;margin-left: 10px;color:#bababa">{{ index+2+'楼'}}</p></div></li>
   
  <li style="width:100%;min-height: 50px;text-align: left"><p style="font-size:14px;margin-right: 5px;text-indent:2em;">{{li.content}}</p></li>
  <li style="width:100%;height: 20px"><span style="font-size:12px;float: right;margin-right: 5px;color:#bababa">{{myDate(li.release_time)}}</span></li>
  </ul>
                
            </li>
            </transition-group>
                 </div>
            
            <li style="width: 100%;height: 30px;margin-top: 10px;min-height:38px;"></li>
            <li v-if='ifshow' style="width: 100%;background-color: #ffffff;position: fixed;bottom:0%;hieght:60px;overflow: hidden">
                <input v-model="replycont" style='width: 85%;border: #ffffff  solid 1px;float: left;height: 30px' placeholder='要不留个言再走~' /><img v-on:click="Reply('private/postReply/add')" style='float: right;width: 24px;height: 24px' src='static/images/留言.png' alt='提交' />
            </li>
            
            
            

    </ul>
            <transition name='t' mode="out-in" >
            <div    style="position: fixed;top:40%;width:100%;max-width: 410px;" v-if="warning">
                <div class="warning" style="margin:0 auto;background-color:rgba(255,102,51,0.8);text-align: center;width:100px;color:#fff;border:  #cccccc 1px none;border-radius: 10px;" >asd</div>
            </div>
            </transition>
        </div>
        <script>
     let nowS = '',bool = true,nowtype =0,page;    
     
$(document).ready(function(){
    page = 0;
    
    a.getTop('public/post/get-by-page',{page,isTop:1,plate:nowtype});
    $('.ass').on('click',() =>{
         a.getTop('public/post/get-by-page',{page,isTop:1,plate:nowtype});
    });
    
    
            $(window).scroll(_.debounce(function(){
let scrollTop = parseInt($(this).scrollTop());

let scrollHeight = $(document).height();
let windowHeight = $(this).height();
if(bool){
    nowS = parseInt($(this).scrollTop());
console.log(nowS);
}


if(scrollTop + windowHeight == scrollHeight || scrollTop + windowHeight == scrollHeight-2 ||scrollTop + windowHeight == scrollHeight+1){
console.log("已经到最底部了！");
//这里写实例的新增楼层的方法 和留言

page++;
a.addLIS('public/post/get-by-page',{page,isTop:0,plate:nowtype});



}

},300)
        );
});


class F {
    
    
    constructor(redata = [],ansy,myid =null,myhead=null){
        this.ve = new Vue({
            el:'#data',
            data:{
                lis:[],
                conts:[],
                nowc:{},
                postdata:'',
                postdatasave:'??',
                ifshow:false,
                qo:'',
                qt:'',
                replyId:'',
                tempId:'',//点击了的帖子的id
                replycont:'',
                showDataW:redata,  //一共5个位置
                ansytype:ansy,
                myid:myid,
                myhead:myhead,
                warning:false
                
            },
            methods:{
                myDate(ydate){
                    
                    var date = new Date(ydate);
                     
   
                    
                    if(ydate !== '刚刚'){
                    var y = date.getFullYear();  
                var m = date.getMonth() + 1;  
                m = m < 10 ? ('0' + m) : m;  
                var d = date.getDate();  
                d = d < 10 ? ('0' + d) : d;  
                var h = date.getHours();  
                h=h < 10 ? ('0' + h) : h;  
                var minute = date.getMinutes();  
                minute = minute < 10 ? ('0' + minute) : minute;  
                var second=date.getSeconds();  
                second=second < 10 ? ('0' + second) : second;  
                return y + '-' + m + '-' + d+' '+h+':'+minute+':'+second;  
                    }else{
                        return '刚刚';
                    }
                    
                },
                post(url,p = {},func= undefined ){
                    //差板块id  和
                    
            
             p.uid = this.myid;
             p.title = this.qo;
             p.content = this.qt;
             p.isTop = 0;
             p[this.ansytype] =nowtype;
            
         Vue.http.post(allurl+url,p, {emulateJSON: true}).then(  (response) => {
          if(response.bodyText === 'success')  { console.log('发布成功');$(".tli").css("top","");$(".mypost").show() ;$(".postcontent").hide();$(".postpng").show() ; 
              this.lis = [];
              page = 0;
              a.getTop('public/post/get-by-page',{page,isTop:1,plate:nowtype});
             /* p.reply_num = '0';
              p.release_time = '刚刚';
              p.head_pic = this.myhead;
              p.nick_name = '我';
          this.lis.unshift(p);//['uid','releaseTime','title','content','replyNum'] */
          $(".tli").css("top","");$(".mypost").show() ;$(".postcontent").hide();$(".postpng").show();
          this.warning =true;
          setTimeout(()=>{  $('.warning').text('发布成功'); },200);
         
          setTimeout(()=>{ this.warning = false; },1000);
          
                        }
          if(func){  func(); };
         }); 
    },
    Reply(url,p = {},func = undefined ){
                    //需要  postId uid content
                                p.uid = this.myid;        
            p.postId = this.tempId;
             p.content = this.replycont;
                    if(p.postId){
             
            
             console.log(p);//这是发布的也包括留言  一切发送的东西
         Vue.http.post(allurl+url,p, {emulateJSON: true}).then(  (response) => {
          if(response.bodyText === 'success')  { console.log('发布成功');$(".tli").css("top","");$(".mypost").show() ;$(".postcontent").hide();$(".postpng").show() ; 
              p.head_pic = this.myhead;
              p.release_time = '刚刚';
              p.nick_name = '我';
          this.conts.push(p);
                        }
          if(func){  func(); };
         }); 
                    }else{
                        this.warning =true;
          setTimeout(()=>{  $('.warning').text('先晃晃再来回复自己的帖子'); },200);
         
          setTimeout(()=>{ this.warning = false; },1000);
                    }
                    
           
    },
    another(li,p={}/*回复的实体*/,url = undefined){
        this.conts = [];
       this.nowc = li;
        this.tempId = li.pid;
        a.changeNOWC(url,p);
    }
            }
        });
    }
    
    
   
    
    getTop(url,p={}){
        /* if(p.type == null){
            delete p.type;
        }  
        
         if(p.plate == null){
            delete p.plate;
        } */
        for(let c in p){
            if(p.c == null){
                delete p.c;
            }
        }
                                                     
             Vue.http.get(allurl+url,{params:p}).then(  (response) => {
            let f =  eval("("+response.bodyText+")");
            f.forEach( (data) => {  a.ve.lis.push(data);  }  );
            
            p.isTop = 0;
        this.addLIS(url,p);
        });
            
    }
    
    addLIS(url,p={}){          

         Vue.http.get(allurl+url,{params:p}).then(  (response) => {
            let fs =  eval("("+response.bodyText+")");
            fs.forEach( (data) => {  a.ve.lis.push(data);  }  );
         });
    }
    
    addCONTS(url,p){  
        
        Vue.http.get(allurl+url,{params:p}).then(  (response) => {
            var f =  eval("("+response.bodyText+")");
            f.forEach( (data) => {  this.ve.conts.push(data);  }  );
         
         });
        
    }
    
    changeNOWC(url,p={}){

        
        setTimeout(()=>{
            bool = false;
        this.ve.ifshow = true;
          //  p = {page:0,postId:this.ve.nowc.pid};
        this.addCONTS(url,p);
        },200);
        
    }
    
}

let a = new F(['nick_name','release_time','title','content','reply_num'],'plateId',1,'http://wx4.sinaimg.cn/mw690/006Zdy2vgy1fn5cqqdux0j31kw0vnjzi.jpg');  //后面两个 一个是id   一个是图片

a.ve.postdatasave = {uid:null,title:null,content:null,postId:null};




            $('.myfont').click( function(){
              $('.myfont').removeClass('blue');
               $(this).addClass('blue');
            });
            
var allurl = '';

        </script>
        
    </body>
</html>
